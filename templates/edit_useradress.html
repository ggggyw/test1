<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户地址管理</title>
    <style>
        body {
    font-family: Arial, sans-serif;
    background-color: #f5f5f5;
    margin: 0;
    padding: 20px;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    background-color: #fff;
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

h1 {
    text-align: center;
    color: #333;
}

h2 {
    margin-top: 20px;
    color: #666;
}

.address-list {
    margin-bottom: 20px;
}

.default-address {
    background-color: #f9f9f9;
    padding: 10px;
    border-radius: 5px;
}

.default-address p {
    margin: 5px 0;
}

.other-addresses ul {
    list-style-type: none;
    padding: 0;
}
.other-addresses li {
    background-color: #f9f9f9;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.add-address form {
    display: flex;
    flex-direction: column;
}

.add-address input[type="text"],
.add-address button {
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
}

.add-address button {
    background-color: #4CAF50;
    color: white;
    cursor: pointer;
}

.buttons {
    text-align: right;
    margin-top: 20px;
}

.buttons button {
    padding: 10px 20px;
    margin-left: 10px;
    border-radius: 5px;
    border: none;
    background-color: #4CAF50;
    color: white;
    cursor: pointer;
}

.modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.4);
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 400px;
    border-radius: 5px;
}

.close-btn {
    margin-left: 10px;
    background-color: #f44336;
}

.edit-btn {
    padding: 5px 10px;
    background-color: #2196F3;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

    </style>
</head>
<body>
    <div class="container">
        <h1>用户地址管理</h1>
        <div class="address-list">
            <div class="default-address">
                <h2>默认地址</h2>
                <p id="defaultAddress"></p>
                <button class="edit-btn" data-address-id="">编辑</button>
            </div>
            <div class="other-addresses">
                <h2>其他地址</h2>
                <ul id="otherAddresses"></ul>
            </div>
        </div>
        <div class="add-address">
            <h2>添加新地址</h2>
            <form id="addAddressForm">
                <input type="text" name="address" placeholder="输入新地址" required>
                <label><input type="checkbox" name="is_default"> 设为默认地址</label>
                <button type="submit">添加</button>
            </form>
        </div>
        <div class="buttons">
            <button id="saveBtn">保存</button>
            <button id="backBtn">返回</button>
        </div>
    </div>

    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2>编辑地址</h2>
            <form id="editAddressForm">
                <input type="text" name="address" placeholder="编辑地址" required>
                <label><input type="checkbox" name="is_default"> 设为默认地址</label>
                <input type="hidden" name="address_id">
                <button type="submit">保存</button>
                <button type="button" class="close-btn">取消</button>
            </form>
        </div>
    </div>

    <script>
        // 获取默认地址
function getDefaultAddress() {
    fetch('/api/default-address')
        .then(response => response.json())
        .then(data => {
            document.getElementById('defaultAddress').textContent = data.address;
            document.querySelector('.default-address .edit-btn').dataset.addressId = data.address_id;
        });
}

// 获取其他地址
function getOtherAddresses() {
    fetch('/api/other-addresses')
        .then(response => response.json())
        .then(data => {
            const otherAddressesList = document.getElementById('otherAddresses');
            otherAddressesList.innerHTML = '';
            data.forEach(address => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${address.address}</span>
                    <button class="edit-btn" data-address-id="${address.address_id}">编辑</button>
                `;
                otherAddressesList.appendChild(li);
            });
        });
}

// 添加新地址
function addAddress(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    fetch('/api/add-address', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        form.reset();
        getDefaultAddress();
        getOtherAddresses();
    });
}

// 编辑地址
function editAddress(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    fetch('/api/edit-address', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        closeModal();
        getDefaultAddress();
        getOtherAddresses();
    });
}

// 打开编辑地址模态框
function openEditModal(event) {
    const addressId = event.target.dataset.addressId;
    fetch(`/api/get-address/${addressId}`)
        .then(response => response.json())
        .then(data => {
            const form = document.getElementById('editAddressForm');
            form.address.value = data.address;
            form.is_default.checked = data.is_default;
            form.address_id.value = data.address_id;
            document.getElementById('editModal').style.display = 'block';
        });
}

// 关闭模态框
function closeModal() {
    document.getElementById('editModal').style.display = 'none';
}

// 保存地址
function saveAddresses() {
    fetch('/api/save-addresses', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        alert('地址保存成功');
    });
}

// 返回
function goBack() {
    window.location.href = '/back-url';
}

document.addEventListener('DOMContentLoaded', () => {
    getDefaultAddress();
    getOtherAddresses();

    document.getElementById('addAddressForm').addEventListener('submit', addAddress);
    document.getElementById('editAddressForm').addEventListener('submit', editAddress);
    document.getElementById('saveBtn').addEventListener('click', saveAddresses);
    document.getElementById('backBtn').addEventListener('click', goBack);

    document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', openEditModal);
    });

    document.querySelector('.close-btn').addEventListener('click', closeModal);
});
    </script>
</body>
</html>
