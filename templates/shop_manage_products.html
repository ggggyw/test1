<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    {% load static %}
    <title>shop_manage_products</title>
    <link rel="stylesheet" href="{% static '商家_files/shop_manage_products.css' %}">


    <style>
        /* --------------------------------------页面整体字体和背景 ------------------------------*/
        body {
            margin: 0;
            padding: 0;
            font-family: "Arial", sans-serif;
            background-attachment: fixed;
            background-size: cover;
            color: #333;
        }

        body, html {
            background: #6ec2ea;
            height: 100%;
        }

        /* ------------------------------------------头部样式--------------------------------- */
        .shop_head {
            background-color: #8accf8; /* 深色背景 */
            color: #fff;
            padding: 10px 0;
            width: 100%; /* 设置宽度为100% */
        }

        .shop_head-in {
            max-width: 1320px;
            margin: 0 auto;
            display: flex;
            width: 100%; /* 设置宽度为100% */
            justify-content: space-between;
            align-items: center;
        }

        .shop_register a {
            color: #fff;
            margin-right: 1px;
            text-decoration: none;
            transition: color 0.3s;
        }

        .shop_register a:hover {
            color: #030303;
            font-size: 15px;
        }

        /* --------------------------------------------搜索框样式----------------------------------- */
        .shop_search {
            padding: 15px 0;
            background-color: #fff;
            border-bottom: 1px solid #eaeaea;
        }

        .shop_search .input {
            display: flex; /* 使用flex布局 */
            align-items: center; /* 垂直居中对齐 */
            justify-content: start; /* 从左边开始排列 */
            max-width: 1320px;
            margin: 0 auto;
            position: relative;
        }

        .shop_search input[type="text"] {
            flex-grow: 1; /* 让输入框填满剩余空间 */
            padding: 10px 15px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 2px;
            margin-left: 10px; /* 在图标和输入框之间添加间距 */
            color: #000; /* 默认颜色，可根据实际需要调整 */
        }

        .shop_search img {
            width: 50px;
            height: auto;
            transition: transform 0.3s ease; /* 添加平滑过渡效果 */
        }

        .shop_search img:hover {
            cursor: pointer;
            transform: scale(1.2); /* 放大10% */
        }

        /* -------------------------------------------------------------类别导航样式--------------------------------------------- */
        .shop_classes {
            z-index: 0;
            padding: 10px 0;
            background: #ffffff;
            margin: 0px auto; /* 增加外部间距 */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 2000px; /* 设置一个最大宽度 */
            display: flex; /* 使用flex布局 */
            justify-content: center; /* 水平居中 */
            flex-wrap: wrap; /* 允许子元素换行 */
            border-radius: 0; /* 修改这里 */
        }

        /* 将每个类别列表设置为块级元素，这样它们将各占一行 */
        .shop_classes-items {
            display: flex;
            flex-direction: row;
            justify-content: center;
            padding: 0;
            margin: 0 1px; /* 添加左右间距用于分隔两个列表 */
            text-align: center; /* 文字居中 */
            list-style: none; /* 去除列表默认样式 */
            position: relative;
        }


        .shop_classes-items a {

            text-align: center;
            display: block;
            font: bold 16px Arial, sans-seri;
            white-space: nowrap;
            clear: both;
            padding: 0 1px;
            margin: 0 5px;
            transition: background-color 0.3s, color 0.3s;
            border-radius: 0; /* 修改这里 */
        }

        .shop_classes-items a:hover {
            background-color: #524747;
            color: #ee4848;
        }

        /* 表单错误信息 */
        ul.errorlist {
            padding: 0;
            margin: 0;
            color: #dc3545; /* 错误信息颜色 */
        }

        ul.errorlist li {
            list-style-type: none; /* 去除列表符号 */
            color: #ff0000;
        }

        /* 选中的类别样式 */
        .shop_classes-items a.selected {
            background-color: #89cdda; /* 被选中项的背景色 */
            color: #fff; /* 被选中项的文本色 */
            border: 2px solid #ffffff; /* 边框，可以根据需要调整颜色和大小 */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* 阴影效果 */
            /* 可加入其他样式，如边框、阴影等 */
        }

        .shop_classes-items a.selected1 {
            background-color: #89cdda; /* 被选中项的背景色 */
            color: #fff; /* 被选中项的文本色 */
            border: 2px solid #ffffff; /* 边框，可以根据需要调整颜色和大小 */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* 阴影效果 */
            transition: all 0.8s ease;
            /* 可加入其他样式，如边框、阴影等 */
        }

        /* 底部滑块的样式 */
        .shop_classes-slider {
            height: 6px;
            width: 2px;
            background-color: #89cdda; /* 滑块颜色 */
            position: absolute;
            bottom: 0;
            transition: all 0.2s ease; /* 平滑的过渡效果 */
        }

        /* 类别项样式 */
        .shop_items {
            display: flex;
            flex-direction: row;
            margin: 5px; /* 给每个项目添加外边距增加间隔感 */
        }

        .shop_items a {
            display: block;
            padding: 10px 15px;
            text-decoration: none;
            color: #333;
            border-right: 1px solid #e5e5e5; /* 在列表项之间添加边框 */
            transition: background-color 0.3s;
        }


        .shop_items a:hover {
            background-color: #c2c2c2; /* 将背景设置为深灰色 */
            color: #fff; /* 通常鼠标悬停时文本颜色需要设为亮色，以保证对比 */
        }

        .product-actions a {
            margin-right: 5px; /* 在按钮之间添加一些间隔 */
            text-decoration: none; /* 移除链接下划线 */
        }

        .product-actions a:last-child {
            margin-right: 0; /* 最后一个按钮不需要间隔 */
        }

        table {
            margin: 20px auto;
            width: 100%; /* 宽度已经是100%，这会使表格根据其父容器的宽度进行伸展 */
            background-color: #efefef;
            border-collapse: collapse; /* 移除单元格之间的间隔 */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15); /* 给表格增加一些阴影效果 */
        }

        /* 调整表头的样式 */
        th {
            background-color: #4CAF50; /* 示例背景颜色，可根据喜好修改 */
            border: 1px solid #ddd; /* 定义边框颜色、风格和宽度 */
            color: white;
            font-size: 15px; /* 增大字体尺寸 */
            text-align: center;
            padding: 10px 5px; /* 增加垂直和水平内边距 */
        }

        /* 调整单元格的样式 */
        td {
            border: 1px solid #ddd; /* 定义边框颜色、风格和宽度 */
            padding: 10px 5px; /* 增加垂直和水平内边距 */
            text-align: left;
        }

        /* 针对特定的列设置固定像素宽度 */
        th:nth-child(5),
        td:nth-child(5) { /* 将n替换成特定列的序号 */
            width: 150px; /* 假设您想将某一列的宽度设定为150像素，可以根据实际需要调整 */
        }

        /* 鼠标悬浮在单元格上时改变背景色，增强交互体验 */
        tr:hover {
            background-color: #f5f5f5;
        }

        /* 调整表格中"操作"列的样式 */
        th:nth-last-child(-n+1),
        td:nth-last-child(-n+1) {
            width: 15%; /* 给"操作"列更宽的空间，这里假设最后三列为"操作"相关 */
            padding-left: 5px; /* 减少左侧内边距 */
            padding-right: 5px; /* 减少右侧内边距 */
            text-align: center; /* 文本居中对齐 */
        }

        /* 设置搜索框区域的样式 */
        #search-bar {
            background-color: #d8e8f8; /* 设置搜索栏的背景颜色 */
            padding: 20px; /* 设置内边距使内容不紧贴边框 */
            border-radius: 8px; /* 设置边框为圆角 */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 添加层次感的阴影效果 */
            margin-bottom: 20px; /* 与页面其他部分保持距离 */
        }

        .search-row {
            display: flex; /* 继续使用Flexbox布局 */
            justify-content: space-between; /* 使内容均匀分布在行中 */
            flex-wrap: wrap; /* 如果有必要，允许内容换行 */
            gap: 10px; /* 维持字段之间的间隔为10px */
            margin-bottom: 18px; /* 行与行之间保留20px的距离 */
        }

        /* 设置搜索字段的边框和背景 */
        .search-field {
            display: flex; /* 使用Flexbox布局 */
            flex-direction: row; /* 子元素方向排列 */
            border: 1px solid #000000; /* 设置边框颜色和宽度 */
            background-color: #9ad0ff; /* 设置背景颜色 */
            border-radius: 4px; /* 字段的边框圆角 */
            padding-left: 10px; /* 字段内部左边距 */
            margin-right: 8px; /* 字段间的距离 */
            flex: 1; /* 每个字段都可以根据内容自动伸缩 */
            max-width: calc(33.333333333% - 1px); /* 最大宽度为行宽的三分之一减去定义的间隔（这里考虑了每行最多3个搜索字段） */
            box-sizing: border-box; /* 包括padding和border在内部的总宽度计算 */
        }

        .range-input {
            flex: 1; /* 允许输入框填满父容器分配的空间 */
            max-width: calc(30% - 10px); /* 调整计算公式以避免换行，需要根据实际情况留出一定空间给分隔符 */
            background-color: #ffffff; /* 浅蓝色背景，你可以根据需要进行更改 */
            border: 1px solid #b6d4fd; /* 浅蓝色边框 */
            border-radius: 4px; /* 圆角边框 */
            padding: 5px; /* 内填充 */
            margin: 0 5px; /* 与分隔符或其他输入框的外边距留白 */
            text-align: start; /* 文本居中 */
        }

        .range-separator {
            display: inline-block;
            line-height: 30px; /* 将分隔符垂直对齐 */
        }

        /* 通过这个类为范围输入字段定制更多样式 */
        .range-field {
            display: flex;
            align-items: center; /* 垂直居中对齐 */
            flex-wrap: nowrap; /* 阻止内部元素换行 */
            justify-content: flex-start; /* 根据需要调整，这里是从行首开始排列 */
            width: 20%; /* 确保占满父容器宽度 */
        }

        /* 设置搜索输入字段和选择菜单的字体大小 */
        .search-field input,
        .search-field select,
        .search-field label {
            font-size: 18px; /* 或你希望的任何大小 */

        }

        /* 目标只有在 .search-buttons 下的 .search-field 的元素 */
        .search-buttons .search-field-buttons {
            background-color: #d8e8f8; /* 这里的背景色是灰色, 你可以根据需要更改 */
            padding: 10px; /* 添加一些填充, 使背景更显著 */
            border-radius: 5px; /* 如果需要，给背景添加圆角 */
            display: flex; /* 使用Flexbox布局 */
            justify-content: center; /* 将按钮放置在中心 */
        }

        /* 美化按钮的样式 */
        input[type="submit"], input[type="reset"] {
            cursor: pointer; /* 鼠标悬停时的手型光标 */
            font-weight: bold; /* 字体加粗 */
            background-color: #007bff; /* 背景颜色 */
            border: none; /* 无边框 */
            border-radius: 10px; /* 圆角边框 */
            color: white; /* 文字颜色 */
            padding: 10px 20px; /* 内边距 */
            margin: 0 5px; /* 外边距进行留白 */
            transition: background-color 0.3s; /* 过渡效果使按钮按下更具反馈 */
        }

        /* 添加鼠标悬停时按钮的效果 */
        input[type="submit"]:hover, input[type="reset"]:hover {
            background-color: #0056b3; /* 按钮被悬停时的背景颜色 */
        }

        /* 清除搜索按钮特定样式 */
        input[type="reset"] {
            background-color: #6c757d; /* 设置清除按钮的背景颜色 */
        }

        input[type="reset"]:hover {
            background-color: #5a6268; /* 按钮被悬停时的背景颜色 */
        }


        /* 没有商品时显示的动画效果 */
        .no-products-animation2 {
            display: none; /* 默认不显示，通过JavaScript控制显示 */
            animation: fadeInToRed 2s ease infinite; /* 添加淡入淡出的无限循环动画，每次动画持续3秒 */
            position: fixed; /* 使用固定定位，确保元素即使在页面滚动时也保持在预定位置 */
            bottom: 25%; /* 相对于视口底部的位置，调整这个值可以控制元素距离底部的高度 */
            left: 50%; /* 相对于视口左侧的位置，保证元素水平居中 */
            transform: translateX(-50%); /* 水平居中元素；由于是相对于左侧50%定位，需要左移元素宽度的50%来实现居中 */
            width: 100%; /* 元素宽度设置为100%，这样文本居中可以相对于整个视口宽度居中 */
        }

        /* 没有商品时显示的文本样式 */
        .no-products-animation2 p {
            text-align: center; /* 文本居中对齐 */
            font-size: 5em; /* 字体大小为2em，根据需要调整 */
            color: #f82800; /* 字体颜色为淡红色，看起来更柔和 */
            margin: 0; /* 移除默认的边距，确保元素位置准确 */
        }

        /* 键帧动画 */
        @keyframes fadeInToRed {
            from {
                opacity: 0; /* 开始时完全透明 */
                background-color: transparent; /* 背景色为透明 */
            }
            to {
                opacity: 1; /* 结束时完全不透明 */
            }
        }

        /*---------------------------------------分页控件-------------------------------------------*/
        .pagination {
            text-align: center; /* 居中分页控件 */
            margin-top: 20px; /* 顶部距离，可根据需要调整 */
            margin-bottom: 20px; /* 底部距离，可根据需要调整 */
        }

        .pagination .step-links span.current {
            font-weight: bold; /* 当前页加粗显示 */
        }

        /* 页码相关样式 */
        .pagination .step-links a,
        .pagination .step-links span {
            margin: 0 5px;
            padding: 5px 10px;
            border: 1px solid #337ab7;
            background-color: #337ab7;
            color: #ffffff;
            font-weight: bold;
            text-decoration: none;
        }

        .pagination .step-links a:hover {
            background-color: #23527c;
        }

        .pagination .step-links span.current {
            font-weight: bold;
            background-color: #337ab7;
            color: white;
            border-color: #337ab7;
        }

        .shop_manage_content {
            width: 1300px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding: 10px 0;
            background-color: #fff;
            max-width: 1300px; /* 设置一个最大宽度 */
            margin: 1px auto; /* 上下保持20px间距，左右自动，以达到居中效果 */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* 添加阴影效果 */
            border-radius: 10px; /* 边框圆角 */
        }

        .search-section {
            display: flex; /* 使用Flex布局 */
            flex-direction: column; /* 子项垂直排列 */
            align-items: stretch; /* 子项沿交叉轴的延伸 */
            width: 100%; /* 确保容器的宽度是100% */
            margin: auto; /* 如果需要，可以水平居中 */
        }

        /* ---------------------------------------------没有商品的提示----------------------------------------------- */

        .messages {
            position: fixed; /* 固定定位 */
            top: 50%; /* 顶部距离页面视图窗口中心 */
            left: 50%; /* 左侧距离页面视图窗口中心 */
            transform: translate(-50%, -50%); /* 位移变换以确保准确居中 */
            z-index: 1000; /* 确保提示框显示在最上层 */
            text-align: center;
        }

        .message {
            background-color: #ff4d4f; /* 美化后的背景色 */
            color: #ffffff; /* 字体颜色为白色以确保可读性 */
            border: none; /* 去除边框 */
            padding: 15px 30px; /* 调整内边距为更舒适的空间 */
            margin-bottom: 10px; /* 保持外边距 */
            display: inline-block;
            font-size: 25px;
            border-radius: 25px; /* 圆角增加以更趋于流线形状 */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 添加阴影为提示框增添深度 */
            align-items: center;
            justify-content: center;
            transition: all 0.3s; /*添加简短的过渡动画效果*/
        }

    </style>
</head>
<body>

<div class="shop_head">
    <div class="shop_head-in">
        <div class="shop_register"><a href="{% url 'logout' %}">退出登录</a></div>
        <div class="shop_register"><a href="http://127.0.0.1:8000/shop/shoppage/shop_profile">查看个人信息</a></div>
    </div>
</div>
<div class="shop_search">
    <form action="{% url 'myproducts' %}" method="get" id="search-form" class="input">
        <img src="{% static '首页_files/1_06.png' %}" onclick="document.getElementById('search-form').submit();"
             style="cursor: pointer;" alt="Search">
        <input type="text" name="query" id="search-box" value="{{ query|default_if_none:'请输入想找的宝贝' }}"
               style="color: {{ query|yesno:'#000,#aaa' }};"
               onfocus="if (this.value == '请输入想找的宝贝') {this.value = ''; this.style.color = '#000';}"
               onblur="if (this.value == '') {this.value = '请输入想找的宝贝'; this.style.color = '#aaa';}">
    </form>
</div>
<div class="shop_classes">
    <div class="shop_classes-top">
        <ul class="shop_classes-items">
            <li class="shop_items"><a
                    href="http://127.0.0.1:8000/shop/shoppage/?category_id=0&query={{ query|default_if_none:'请输入想找的宝贝' }}">首页</a>
            </li>
            <li class="shop_items"><a
                    href="http://127.0.0.1:8000/shop/shoppage/myproducts/?category_id=0&query={{ query|default_if_none:'请输入想找的宝贝' }}"
            >我的商品</a>
            </li>
            <li class="shop_items"><a
                    href="http://127.0.0.1:8000/shop/shoppage/manage_products/?category_id=0"
                    class="selected1">管理商品</a>
            </li>
            <li class="shop_items"><a href="http://127.0.0.1:8000/shop/shoppage/shop_order/">我的订单</a></li>
            <li class="shop_items"><a href="http://127.0.0.1:8000/shop/shoppage/rfm/">RFM分析</a></li>
        </ul>
    </div>

</div>
<!-- 在这里添加一个 '增加商品' 的按钮 -->
<div class="shop_manage_content">
    <div class="search-section">
        <div class="add-product-button">
            <a href="{% url 'add_product' %}" class="btn btn-success">增加商品</a>
            <a href="javascript:void(0);" onclick="toggleSearchBar();" class="btn btn-info">搜索商品</a>
        </div>
        <!-- 创建一个初始隐藏的搜索栏 -->
        <div id="search-bar" style="display: none;">
            <form action="{% url 'shop_search_manage_products' %}" method="get">
                <!-- 第一行 -->
                <div class="search-row">
                    <div class="search-field">
                        <label for="product_name">商品名称:</label>
                        <input type="text" id="product_name" name="product_name" placeholder="商品名称"
                               value="{{ product_name }}" maxlength="50">
                    </div>
                    <div class="search-field">
                        <label for="brand">商品品牌:</label>
                        <input type="text" id="brand" name="brand" placeholder="品牌" value="{{ brand }}"
                               maxlength="50">
                    </div>
                    <div class="search-field range-field">
                        <label for="stock_range">库存范围:</label>
                        <input type="number" class="range-input" id="min_stock" name="min_stock"
                               placeholder="最低库存" value="{{ min_stock }}" min="0" max="99999">
                        <span class="range-separator">~</span>
                        <input type="number" class="range-input" id="max_stock" name="max_stock"
                               placeholder="最高库存" value="{{ max_stock }}" min="0" max="99999">
                    </div>
                </div>
                <!-- 第二行 -->
                <div class="search-row">
                    <div class="search-field">
                        <label for="category_id">商品类别:</label>
                        <select id="category_id" name="category_id">
                            <option value="0" {% if category_id == "0" %}selected{% endif %}>全部商品</option>
                            <option value="1" {% if category_id == "1" %}selected{% endif %}>个人电脑和配件</option>
                            <option value="2" {% if category_id == "2" %}selected{% endif %}>移动设备</option>
                            <option value="3" {% if category_id == "3" %}selected{% endif %}>家用电子产品</option>
                            <option value="4" {% if category_id == "4" %}selected{% endif %}>厨房电子设备</option>
                            <option value="5" {% if category_id == "5" %}selected{% endif %}>办公设备</option>
                            <option value="6" {% if category_id == "6" %}selected{% endif %}>汽车电子设备</option>
                            <option value="7" {% if category_id == "7" %}selected{% endif %}>网络和通信设备</option>
                            <option value="8" {% if category_id == "8" %}selected{% endif %}>可穿戴设备</option>
                            <option value="9" {% if category_id == "9" %}selected{% endif %}>智能家居设备</option>
                        </select>
                    </div>
                    <div class="search-field">
                        <label for="status">商品状态:</label>
                        <select id="status" name="status">
                            <option value="">所有状态</option>
                            <option value="上架" {% if status == "上架" %}selected{% endif %}>上架</option>
                            <option value="下架" {% if status == "下架" %}selected{% endif %}>下架</option>
                        </select>
                    </div>
                    <div class="search-field">
                        <label for="audit_status">审核状态:</label>
                        <select id="audit_status" name="audit_status">
                            <option value="">所有状态</option>
                            <option value="待审核" {% if audit_status == "待审核" %}selected{% endif %}>待审核</option>
                            <option value="审核通过" {% if audit_status == "审核通过" %}selected{% endif %}>审核通过
                            </option>
                            <option value="审核不通过" {% if audit_status == "审核不通过" %}selected{% endif %}>审核不通过
                            </option>
                        </select>
                    </div>
                </div>
                <!-- 第三行 -->
                <div class="search-row">
                    <div class="search-field range-field">
                        <label for="original_price">原始价格:</label>
                        <input type="number" class="range-input" id="min_original_price" name="min_original_price"
                               placeholder="最低价" value="{{ min_original_price }}" min="0" max="99999">
                        <span class="range-separator">~</span>
                        <input type="number" class="range-input" id="max_original_price" name="max_original_price"
                               placeholder="最高价" value="{{ max_original_price }}" min="0" max="99999">
                    </div>
                    <div class="search-field range-field">
                        <label for="current_price">现在价格:</label>
                        <input type="number" class="range-input" id="min_current_price" name="min_current_price"
                               placeholder="最低价" value="{{ min_current_price }}" min="0" max="99999">
                        <span class="range-separator">~</span>
                        <input type="number" class="range-input" id="max_current_price" name="max_current_price"
                               placeholder="最高价" value="{{ max_current_price }}" min="0" max="99999">
                    </div>
                    <div class="search-field range-field">
                        <label for="discount">商品折扣:</label>
                        <input type="number" class="range-input" id="min_discount" name="min_discount"
                               placeholder="最小折扣" value="{{ min_discount }}" step="0.01" min="0" max="1">
                        <span class="range-separator">~</span>
                        <input type="number" class="range-input" id="max_discount" name="max_discount"
                               placeholder="最大折扣" value="{{ max_discount }}" step="0.01" min="0" max="1">
                    </div>
                </div>
                <!-- 第四行 -->
                <div class="search-row">
                    <div class="search-field">
                        <label for="description">商品描述:</label>
                        <input type="text" id="description" name="description" placeholder="描述"
                               value="{{ description }}"
                               maxlength="50">
                    </div>
                </div>
                <!-- 第五行 -->
                <div class="search-buttons"> <!-- 添加 search-buttons 类 -->
                    <div class="search-field-buttons">
                        <input type="submit" value="搜索" class="search-button"> <!-- 添加 search-button 类 -->
                        <input type="reset" value="清除搜索" class="search-button clear-search-button"
                               onclick="clearSearch()"> <!-- 添加 clear-search-button 类 -->
                    </div>
                </div>
            </form>
        </div>
    </div>
    {% if shop_products %}
        <table>
            <tr>
                <th>商品名称</th>
                <th>图片</th>
                <th>类别</th>
                <th>品牌</th>
                <th>描述</th>
                <th>状态</th>
                <th>审核状态</th>
                <th>库存</th>
                <th>原始价格</th>
                <th>折扣</th>
                <th>现在价格</th>
                <th>操作</th>
            </tr>
            {% for shop_product in shop_products %}
                <tr>
                    <td>{{ shop_product.product.p_name }}</td>
                    <td>
                        <img src="{% static '商品图片/'|add:shop_product.product_image_url %}" width="150px"
                             height="150px"
                             onerror="this.onerror=null;this.src='{% static '商家_files/noimage.png' %}';">
                    </td>
                    <td>{{ shop_product.product.p_type.category_name }}</td>
                    <td>{{ shop_product.product.brand }}</td>
                    <td>{{ shop_product.product_desc }}</td>
                    <td style="color: {% if shop_product.product_status == '上架' %}green{% elif shop_product.product_status == '下架' %}red{% endif %};font-weight: bold">{{ shop_product.product_status }}</td>
                    <td style="color: {% if shop_product.product_auditstatus == '待审核' %}#fa9700{% elif shop_product.product_auditstatus == '审核通过' %}green{% elif shop_product.product_auditstatus == '审核不通过' %}red{% endif %};font-weight: bold">{{ shop_product.product_auditstatus }}</td>
                    <td style="color: {% if shop_product.stock_quantity < 20 %}red{% else %}black{% endif %};">{{ shop_product.stock_quantity }}</td>
                    <td>{{ shop_product.original_price }}</td>
                    <td>{{ shop_product.discount }}</td>
                    <td>{{ shop_product.current_price }}</td>
                    <td>
                        <!-- 操作按钮 -->
                        <div class="product-actions">
                            <a href="{% url 'shop_productdetails' shop_product.shop_product_id %}"
                               class="btn btn-info" title="详情">详情</a>
                            <a href="{% url 'edit_product' shop_product.shop_product_id %}"
                               class="btn btn-primary" title="修改">修改</a>
                            <a href="javascript:void(0);" onclick="confirmDelete({{ shop_product.shop_product_id }});"
                               class="btn btn-danger" title="删除">删除</a>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </table>
        </div>
    {% else %}
        <div class="no-products-animation2">
            <p>没有找到任何商品</p>
        </div>
    {% endif %}
{% if shop_products %}
    <!-- 分页 -->
    <div class="pagination">
    <span class="step-links">
        {% if shop_products.has_previous %}
            <a href="?page=1&category_id={{ category_id }}&product_name={{ product_name }}&brand={{ brand }}&description={{ description }}&status={{ status }}&audit_status={{ audit_status }}&min_stock={{ min_stock }}&max_stock={{ max_stock }}&min_original_price={{ min_original_price }}&max_original_price={{ max_original_price }}&min_discount={{ min_discount }}&max_discount={{ max_discount }}&min_current_price={{ min_current_price }}&max_current_price={{ max_current_price }}">&laquo; 第一页</a>
            <a href="?page={{ shop_products.previous_page_number }}&category_id={{ category_id }}&product_name={{ product_name }}&brand={{ brand }}&description={{ description }}&status={{ status }}&audit_status={{ audit_status }}&min_stock={{ min_stock }}&max_stock={{ max_stock }}&min_original_price={{ min_original_price }}&max_original_price={{ max_original_price }}&min_discount={{ min_discount }}&max_discount={{ max_discount }}&min_current_price={{ min_current_price }}&max_current_price={{ max_current_price }}">上一页</a>
        {% endif %}
        <span class="current">
            第 {{ shop_products.number }} / {{ shop_products.paginator.num_pages }} 页
        </span>
        {% if shop_products.has_next %}
            <a href="?page={{ shop_products.next_page_number }}&category_id={{ category_id }}&product_name={{ product_name }}&brand={{ brand }}&description={{ description }}&status={{ status }}&audit_status={{ audit_status }}&min_stock={{ min_stock }}&max_stock={{ max_stock }}&min_original_price={{ min_original_price }}&max_original_price={{ max_original_price }}&min_discount={{ min_discount }}&max_discount={{ max_discount }}&min_current_price={{ min_current_price }}&max_current_price={{ max_current_price }}">下一页</a>
            <a href="?page={{ shop_products.paginator.num_pages }}&category_id={{ category_id }}&product_name={{ product_name }}&brand={{ brand }}&description={{ description }}&status={{ status }}&audit_status={{ audit_status }}&min_stock={{ min_stock }}&max_stock={{ max_stock }}&min_original_price={{ min_original_price }}&max_original_price={{ max_original_price }}&min_discount={{ min_discount }}&max_discount={{ max_discount }}&min_current_price={{ min_current_price }}&max_current_price={{ max_current_price }}">最后一页 &raquo;</a>
        {% endif %}
    </span>
        <!-- 页码跳转表单，同时也传递所有搜索参数 -->
        <form action="" method="get" style="display: inline-block;">
            <!-- 保留之前的页面和搜索参数 -->
            <input type="hidden" name="category_id" value="{{ category_id }}">
            <input type="hidden" name="product_name" value="{{ product_name }}">
            <input type="hidden" name="brand" value="{{ brand }}">
            <input type="hidden" name="description" value="{{ description }}">
            <input type="hidden" name="status" value="{{ status }}">
            <input type="hidden" name="audit_status" value="{{ audit_status }}">
            <input type="hidden" name="min_stock" value="{{ min_stock }}">
            <input type="hidden" name="max_stock" value="{{ max_stock }}">
            <input type="hidden" name="min_original_price" value="{{ min_original_price }}">
            <input type="hidden" name="max_original_price" value="{{ max_original_price }}">
            <input type="hidden" name="min_discount" value="{{ min_discount }}">
            <input type="hidden" name="max_discount" value="{{ max_discount }}">
            <input type="hidden" name="min_current_price" value="{{ min_current_price }}">
            <input type="hidden" name="max_current_price" value="{{ max_current_price }}">
            <input type="number" name="page" min="1" max="{{ shop_products.paginator.num_pages }}" required
                   placeholder="页码" style="margin-left: 10px;">
            <input type="submit" value="跳转">
        </form>
        <!-- 在这里显示商品的总数 -->
        <span class="step-links">
            <span class="current">商品总数: {{ shop_products.paginator.count }}</span>
        </span>
    </div>
{% else %}
{% endif %}
<!-- 消息提示 -->
{% if messages %}
    <div id="message-container" class="messages">
        {% for message in messages %}
            <div class="{{ message.tags }} message">{{ message }}</div>
        {% endfor %}
    </div>
{% endif %}
<!-- 模态框 -->
<!-- 添加商品模态框 -->
<div id="addProductModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>添加商品</h2>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ product_form.as_p }}
            {{ shop_product_form.as_p }}
            <div>
                <label for="id_current_price">现在价格:</label>
                <input id="id_current_price" type="text" name="current_price" readonly>
            </div>
            <div>
                <input id="product_audit_status" type="hidden" name="product_audit_status" value="待审核">
            </div>
            <div class="image-preview-container">
                <img id="preview" src="{% static '商品图片/暂无图片.png' %}" alt="上传修改的商品图片" width="200px"
                     height="200px">
                <input id="product_image" type="file" name="product_image" onchange="previewImage(this)">
            </div>
            <button type="submit" class="btn btn-success">添加商品</button>
        </form>
    </div>
</div>
<!-- 模态框 - 删除商品确认 -->
<div id="deleteConfirmModal" class="modal">
    <div class="modal-content">
        <span class="close-delete-modal">&times;</span>
        <p>你确定要删除这个商品吗？此操作不可恢复！</p>
        <div class="modal-actions">
            <button id="confirmDelete">确定</button>
            <button class="cancel-delete-modal">取消</button>
        </div>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelector('.no-products-animation2').style.display = 'block';
    });

    // 获取添加商品模态框元素
    var addProductModal = document.getElementById('addProductModal');
    var closeButtonAddProduct = addProductModal.getElementsByClassName("close")[0];
    var no_products_animation = document.querySelector('.no-products-animation2');

    // 获取删除商品模态框元素
    var deleteConfirmModal = document.getElementById('deleteConfirmModal');
    var closeButtonDeleteModal = deleteConfirmModal.getElementsByClassName("close-delete-modal")[0];
    var cancelDeleteButton = deleteConfirmModal.getElementsByClassName("cancel-delete-modal")[0];

    // 点击添加商品按钮时，显示添加商品模态框
    document.querySelector('.add-product-button a').onclick = function (event) {
        event.preventDefault();
        addProductModal.style.display = "block";
    }

    // 点击关闭按钮关闭添加商品模态框
    closeButtonAddProduct.onclick = function () {
        addProductModal.style.display = "none";
    }

    // 点击删除按钮时，显示删除商品模态框
    function confirmDelete(productId) {
        document.getElementById('confirmDelete').onclick = function () {
            window.location.href = "/shop/shoppage/manage_products/delete_product/" + productId + "/";
        };
        deleteConfirmModal.style.display = "block";
    }

    // 点击关闭按钮关闭删除商品模态框
    closeButtonDeleteModal.onclick = function () {
        deleteConfirmModal.style.display = "none";
    }

    // 点击取消按钮关闭删除商品模态框
    cancelDeleteButton.onclick = function () {
        deleteConfirmModal.style.display = "none";
    }

    // 点击窗口外区域关闭任何打开的模态框
    window.onclick = function (event) {
        if (event.target == addProductModal) {
            addProductModal.style.display = "none";
        } else if (event.target == deleteConfirmModal) {
            deleteConfirmModal.style.display = "none";
        }
    }

    window.onload = function () {
        // 查找消息容器并准备淡出效果
        var messageContainer = document.getElementById('message-container');
        if (messageContainer) {
            // 设置5秒后执行淡出动画
            setTimeout(function () {
                messageContainer.style.opacity = '0'; // 设置透明度为 0 触发消失效果
                setTimeout(function () {
                    messageContainer.style.display = 'none'; // 设置display为none来完全隐藏
                }, 1000); // 额外的时间确保透明度动画完成
            }, 2000); // 你可以调整这里的时间来控制消息显示多久
        }

        // 获取输入框，定义updateCurrentPrice函数，添加事件监听器
        var originalPriceInput = document.getElementById('id_original_price');
        var discountInput = document.getElementById('id_discount');
        var currentPriceInput = document.getElementById('id_current_price');

        function updateCurrentPrice() {
            var originalPrice = parseFloat(originalPriceInput.value);
            var discount = parseFloat(discountInput.value);
            if (!isNaN(originalPrice) && !isNaN(discount)) {
                var currentPrice = originalPrice * (discount);
                currentPriceInput.value = currentPrice.toFixed(2);
            }
        }

        // 现在手动计算并更新当前价格
        updateCurrentPrice();

        originalPriceInput.addEventListener('input', updateCurrentPrice);
        discountInput.addEventListener('input', updateCurrentPrice);

        // 初始根据URL参数判断是否应该显示搜索栏
        var searchParams = new URLSearchParams(window.location.search);
        if (searchParams.get('category_id') !== "0" || // 商品类别不是 "全部商品"
            searchParams.get('status') !== "" || // 商品状态不是 "所有状态"
            searchParams.get('audit_status') !== "" || // 审核状态不是 "所有状态"
            searchParams.get('product_name') || // 商品名称有值
            searchParams.get('brand') || // 品牌有值
            searchParams.get('description') || // 产品描述有值
            searchParams.get('min_stock') || // 最小库存有值
            searchParams.get('max_stock') || // 最大库存有值
            searchParams.get('min_original_price') || // 最低原始价格有值
            searchParams.get('max_original_price') || // 最高原始价格有值
            searchParams.get('min_current_price') || // 最低现价有值
            searchParams.get('max_current_price') || // 最高现价有值
            searchParams.get('min_discount') || // 最小折扣有值
            searchParams.get('max_discount')) // 最大折扣有值
        {
            // 如果任一条件满足，则显示搜索栏
            document.getElementById('search-bar').style.display = "block";
        } else {
            // 如果没有任何搜索参数，则隐藏搜索栏
            document.getElementById('search-bar').style.display = "none";
        }

    };

    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                document.getElementById('preview').src = e.target.result;
            }

            reader.readAsDataURL(input.files[0]);
        }
    }

    // 切换搜索栏的可见性
    function toggleSearchBar() {
        var searchBar = document.getElementById('search-bar');
        if (searchBar.style.display === "none") {
            searchBar.style.display = "block";
        } else {
            searchBar.style.display = "none";
        }
    }

    //判断输入框
    function validateRangeFields() {
        var minPrice = document.getElementById('min_original_price').value;
        var maxPrice = document.getElementById('max_original_price').value;
        var minDiscount = document.getElementById('min_discount').value;
        var maxDiscount = document.getElementById('max_discount').value;
        var minCurrentPrice = document.getElementById('min_current_price').value;
        var maxCurrentPrice = document.getElementById('max_current_price').value;
        var minStock = document.getElementById('min_stock');
        var maxStock = document.getElementById('max_stock');
        // 确保只在二者都不为空时比较库存范围
        if (minStock && maxStock && Number(minStock) > Number(maxStock)) {
            alert('最小库存不能大于最大库存');
            return false;
        }
        // 检查价格范围
        if (minPrice !== '' && maxPrice !== '' && parseFloat(minPrice) > parseFloat(maxPrice)) {
            alert('最低价格不能大于最高价格');
            return false;
        }
        // 检查折扣范围
        if (minDiscount !== '' && maxDiscount !== '' && parseFloat(minDiscount) > parseFloat(maxDiscount)) {
            alert('最小折扣不能大于最大折扣');
            return false;
        }
        // 检查现价范围
        if (minCurrentPrice !== '' && maxCurrentPrice !== '' && parseFloat(minCurrentPrice) > parseFloat(maxCurrentPrice)) {
            alert('最低现价不能大于最高现价');
            return false;
        }

        // 一切正常，允许表单提交
        return true;
    }

    document.getElementById('search-bar').onsubmit = function (event) {
        if (!validateRangeFields()) { // 确保这里调用的是 validateRangeFields
            event.preventDefault(); // 阻止表单提交
        }
    };


    function clearSearch() {
        // 获取表单内的所有输入元素
        var inputs = document.getElementById('search-bar').querySelectorAll('input[type=text], input[type=number], select');

        // 设置每个字段的值为空字符串，除了类别下拉选择菜单
        inputs.forEach(function (input) {
            if (input.name === "category_id") {
                input.value = "0";
            } else {
                // 其它输入字段设置为空字符串
                input.value = '';
            }
        });

        // 提交表单以返回所有商品
        var searchForm = document.getElementById('search-bar').querySelector('form');
        searchForm.submit();
    }
</script>
</body>
</html>