<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    {% load static %}
    <title>shop_order</title>
    <link rel="stylesheet" href="{% static '商家_files/head.css' %}">
    <script src="{% static '首页_files/jquery.min.js.下载' %}"></script>
    <script src="{% static '首页_files/carts.js.下载' %}"></script>

    <style>
           .classes {
            background: #f4f4f4;
            padding: 10px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #ccc;
        }


        .classes-items {
            text-align: center;
        }

        .items {
            text-align: center;
        }

        .order-detail-toggle {
            cursor: pointer;
            background-color: #f9f9f9;
            padding: 5px;
            text-align: center;
            border: 1px solid #d3d3d3;
        }

        .order-details {
            display: none;
            margin-top: 10px;
        }


        /* 将表格居中且宽度最大化，每列有一定的间距 */
        table {
            margin: 0 auto;
            width: 90%;
            border-collapse: separate;
            border-spacing: 0 15px; /* 控制列之间的间距 */
        }

        /* 调整表格标题和内部文本的样式 */
        th, td {
            text-align: center;
            padding: 10px 20px; /* 增加内填充以便有更多空间 */
        }

        /* 为表格标题设置一个背景颜色，字体颜色和字体大小 */
        thead th {
            background-color: #4CAF50; /* 示例背景颜色，可根据喜好修改 */
            color: white; /* 示例字体颜色，可根据喜好修改 */
            font-size: 1.1em;
        }

        /* 为表格每个单元格设置一个背景颜色 */
        tbody td {
            background-color: #f2f2f2; /* 示例背景颜色，可根据喜好修改 */
            border-bottom: 1px solid #ddd; /* 为了清晰分隔各行 */
        }

        /* 为操作按钮增加一些样式来使其更加醒目 */
        .order-detail-toggle {
            border: none; /* 移除边框 */
            color: white; /* 设置字体颜色 */
            padding: 5px 10px; /* 设置内填充 */
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            transition-duration: 0.4s;
            cursor: pointer;
            background-color: #008CBA; /* 背景颜色 */
        }

        /* 当鼠标悬停在操作按钮上时，改变其样式以提供反馈 */
        .order-detail-toggle:hover {
            background-color: #333;
            color: white;
        }

        /* 为发货按钮增加一些样式来使其更加醒目 */
        .order-ship-toggle {
            border: none; /* 移除边框 */
            color: white; /* 设置字体颜色 */
            padding: 5px 10px; /* 设置内填充 */
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            transition-duration: 0.4s;
            cursor: pointer;
            background-color: #29ce01; /* 背景颜色 */
        }

        /* 当鼠标悬停在发货按钮上时，改变其样式以提供反馈 */
        .order-ship-toggle:hover {
            background-color: #333;
            color: white;
        }

        .model {
            display: none; /* 默认不显示模态框 */
            position: fixed; /* 固定定位 */
            z-index: 1; /* z-index 确保模态框在其他内容上方 */
            left: 0;
            top: 0;
            width: 100%; /* 宽度为整个视窗的宽 */
            height: 100%; /* 高度为整个视窗的高 */
            overflow: auto; /* 如果内容过多，出现滚动条 */
            background-color: rgba(0, 0, 0, 0.4); /* 背景颜色带透明度 */
        }

        .model-content {
            background-color: #fefefe; /* 模态框内容背景颜色 */
            margin: 5% auto; /* 上下外边距及自动居中 */
            padding: 20px; /* 内边距 */
            border: 1px solid #888; /* 边框 */
            width: 50%; /* 宽度 */
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2); /* 添加阴影效果 */
            position: relative; /* 相对定位 */
            overflow: hidden; /* 隐藏溢出的内容 */
            border-radius: 10px; /* 圆角边框 */
        }

        /* 模态框标题样式 */
        .Model-content h2 {
            background-color: #4CAF50; /* 标题背景颜色 */
            color: white; /* 标题文本颜色 */
            padding: 10px 20px; /* 标题内填充 */
            margin: -20px -20px 20px -20px; /* 标题外边距 */
            border-top-left-radius: 10px; /* 左上角圆角 */
            border-top-right-radius: 10px; /* 右上角圆角 */
            text-align: center; /* 文本居中 */
        }

        /* 模态框关闭按钮样式 */
        .close {
            position: absolute; /* 绝对定位 */
            top: 10px; /* 距离顶部 */
            right: 20px; /* 距离右侧 */
            color: #aaa; /* 颜色 */
            text-shadow: none; /* 禁用文本阴影 */
            font-weight: normal; /* 字重 */
        }

        /* 模态框中的段落样式 */
        .model-content p {
            font-size: 16px; /* 字体大小 */
            line-height: 1.6; /* 行高 */
            margin-bottom: 15px; /* 段落之间的间距 */
            text-align: left; /* 文本左对齐 */
            border-bottom: 1px solid #eee; /* 可选：每个信息项之间的分割线 */
            padding-bottom: 10px; /* 可选：分割线上方的内边距 */
        }

        /* 最后一个段落的样式，没有底部边框 */
        .model-content p:last-of-type {
            border-bottom: none; /* 去掉最后一个段落的分割线 */
            margin-bottom: 0; /* 调整最后一个段落的外边距 */
            padding-bottom: 0; /* 调整最后一个段落的内边距 */
        }

        /* 模态框中图片的样式 */
        .model-content img {
            margin-top: 10px; /* 图片上方的外边距 */
            display: block; /* 使图片块状显示 */
            margin-left: auto; /* 左自动外边距 */
            margin-right: auto; /* 右自动外边距 */
            max-width: 100%; /* 最大宽度为容器宽度 */
            height: auto; /* 高度自动 */
        }

        .close {
            color: #0c0c0c; /* 关闭按钮颜色 */
            float: right; /* 右浮动 */
            font-size: 28px; /* 字号 */
            font-weight: bold; /* 字重 */
        }

        .close:hover,
        .close:focus {
            color: #e11111; /* 鼠标悬浮或聚焦时颜色改变 */
            text-decoration: none;
            cursor: pointer;
        }

        /* 点击时的高亮背景颜色 */
        .highlight {
            background-color: #ffff99; /* 浅黄色的背景 */
        }


        tbody tr.order-row:hover {
            font-size: 13px; /* 设定鼠标悬停时的字体大小 */
            cursor: pointer; /* 可选，显示鼠标悬停效果 */
            transition: font-size 0.8s ease; /* 平滑的字体大小变化 */
            color: #008CBA; /* 蓝色字体 */
        }

        /* “详情”行在悬停时的样式 */
        tbody tr.order-detail-row:hover {
            color: #008CBA;
            font-size: 13px; /* 设定鼠标悬停时的字体大小 */
            cursor: default;
            transition: background-color 0.3s ease;
        }

        /* 设置为链接的用户名字和商品名字的样式 */
        .dialogue-link {
            cursor: pointer;
            color: #008CBA; /* 蓝色字体 */
            text-decoration: underline; /* 文字下划线 */
            transition: font-size 0.5s ease; /* 平滑的字体大小变化 */
        }

        /* 鼠标悬停在用户名字和商品名字上时的样式 */
        .dialogue-link:hover {
            font-size: 20px; /* 鼠标悬停时字体大小变大 */
            color: #f51111; /* 鼠标悬停时字体颜色的变化 */
        }
    </style>
</head>


<div class="head">
    <div class="head-in">
        <ul class="options">
            <li class="sub"><a href="/user/userorder">我的订单</a></li>
            <li class="sub"><a href="/user/userserve">客户服务</a></li>
        </ul>
        <div class="register"><a href="{% url 'userprofile' %}">查看个人信息</a></div>
        <div class="register"><a href="{% url 'logout' %}">退出登录</a></div>
        <div class="hello">欢迎您！欢迎来到数码产品网上交易平台</div>
    </div>
</div>
<div class="search">
    <div class="input">
        <input type="" name="" value="请输入想找的宝贝">
        <img src="{% static '首页_files/1_06.png' %}">
    </div>
</div>
<div class="classes">
    <ul class="classes-items">

        <li class="items"><a href="http://127.0.0.1:8000/shop/shoppage/myproducts/?category_id=0">我的商品</a></li>
        <li class="items"><a href="http://127.0.0.1:8000/shop/shoppage/manage_products/?category_id=0">管理商品</a></li>
        <li class="items"><a href="http://127.0.0.1:8000/shop/shoppage/shop_order/">我的订单</a></li>
        <li class="items"><a href="http://127.0.0.1:8000/shop/shoppage/rfm/">RFM分析</a></li>
    </ul>
</div>

</head>


<body>
<h1 align="center">RFM 消费者类型分析</h1>
<p></p>


<div>
    <table align="center" id="dataTable" style="display: ">
        <thead>
        <tr>
            <th>用户 ID</th>
            <th>最近一次购买</th>
            <th>最近购买频率</th>
            <th>最近购买金额</th>
            <th>RFM 类别</th>
            <th><label for="filterSelect"></label><select id="filterSelect" onchange="filterTableBySelect()">
    <option value="all">所有类型</option>
    <option value="重要价值客户">111重要价值客户</option>
    <option value="潜力客户">110潜力客户</option>
    <option value="重要深耕客户">101重要深耕客户</option>
    <option value="新客户">100新客户</option>
    <option value="重要唤回客户">011重要唤回客户</option>
    <option value="一般维持用户">010一般维持用户</option>
    <option value="重要挽留客户">001重要挽留客户</option>
    <option value="流失用户">000流失用户</option>
</select></th>
        </tr>
        </thead>
        <tbody>
        {% for consumer in RFM_data %}
            <tr>
                <td> <div class="dialogue-link" onclick="showUserModel({{ consumer.u_id }})">
                             {{ consumer.u_id }}
                             </div>
                </td>
                <td>{{ consumer.Recency }}</td>
                <td>{{ consumer.Frequency }}</td>
                <td>{{ consumer.Monetary }}</td>
                <td>{{ consumer.RFM_Class }}</td>
                <td>{{ consumer.RFM_Label }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
<!-- 用户信息模态框 -->
<div id="userModel" class="model">
    <div class="model-content">
        <span class="close" onclick="closeModel('userModel')">&times;</span>
        <h2>用户信息</h2>
        <!-- 用户信息显示位置 -->
        <div id="userModelInfo">
            <p>用户名: <span id="userModel_u_name"></span></p>
            <p>性别: <span id="userModel_u_sex"></span></p>
            <p>手机号: <span id="userModel_u_phone"></span></p>
            <p>邮箱: <span id="userModel_u_email"></span></p>
            <p>地址: <span id="userModel_u_address"></span></p>
        </div>
    </div>
</div>

<h1 align="center" id="prompt" style="display: none">数据太少，不适合进行分析</h1>
<script>
    //接受消费者数量的数据
    var consumer = {{ RFM_data|length }}
    if(consumer<=5){
        document.getElementById("dataTable").style.display="none"
        document.getElementById("prompt").style.display=""
    }
    //jafwoif


    function filterTableBySelect() {
        var select, filter, table, tr, td, i, txtValue;
        select = document.getElementById("filterSelect");
        filter = select.value.toUpperCase();
        table = document.getElementById("dataTable");
        tr = table.getElementsByTagName("tr");

        for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[5]; // 假设消费者类型在第六列
            if (td) {
                txtValue = td.textContent || td.innerText;
                if (filter === "ALL" || txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
    }
     // 默认情况下，模态框应该被隐藏
    window.onload = function() {
        document.getElementById('userModel').style.display = 'none';
    };

    // 在商家点击消费者（user_id）时调用的函数
    function showUserModel(userId) {
        // 发起 AJAX 请求以获取用户信息
        fetch('/shop/shoppage/shop_order/user/' + userId + '/') // 请注意路径的改变
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(user => {
                // 以下代码是将获取到的用户数据填充到模态框
                document.getElementById('userModel_u_name').textContent = user.u_name;
                document.getElementById('userModel_u_sex').textContent = user.u_sex;
                document.getElementById('userModel_u_phone').textContent = user.u_phone;
                document.getElementById('userModel_u_email').textContent = user.u_email;
                document.getElementById('userModel_u_address').textContent = user.u_address;
                // 显示模态框
                document.getElementById('userModel').style.display = 'block';
            })
            .catch(error => {
                console.error('Error fetching user data:', error);
            });
    }

    // 关闭模态框的函数
    function closeModel(modelId) {
        // 隐藏模态框
        document.getElementById(modelId).style.display = 'none';
    }

    // 点击窗口外区域关闭任何打开的模态框
    window.onclick = function (event) {
        // 确保点击的不是模态框内部或关闭按钮
        if (event.target.id !== 'userModel' && event.target.className !== 'close') {
            closeModel('userModel');
        }
    };

</script>
</body>
</html>