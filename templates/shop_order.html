<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    {% load static %}
    <title>shop_order</title>
    <link rel="stylesheet" href="{% static '商家_files/head.css' %}">
    <script src="{% static '首页_files/jquery.min.js.下载' %}"></script>
    <script src="{% static '首页_files/carts.js.下载' %}"></script>

    <style>
        .classes {
            background: #f4f4f4;
            padding: 10px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #ccc;
        }


        .classes-items {
            text-align: center;
        }

        .items {
            text-align: center;
        }

        .order-detail-toggle {
            cursor: pointer;
            background-color: #f9f9f9;
            padding: 5px;
            text-align: center;
            border: 1px solid #d3d3d3;
        }

        .order-details {
            display: none;
            margin-top: 10px;
        }

        /* 将表格居中且宽度最大化，每列有一定的间距 */
        table {
            margin: 0 auto;
            width: 90%;
            border-collapse: separate;
            border-spacing: 0 15px; /* 控制列之间的间距 */
        }

        /* 调整表格标题和内部文本的样式 */
        th, td {
            text-align: center;
            padding: 10px 20px; /* 增加内填充以便有更多空间 */
        }

        /* 为表格标题设置一个背景颜色，字体颜色和字体大小 */
        thead th {
            background-color: #4CAF50; /* 示例背景颜色，可根据喜好修改 */
            color: white; /* 示例字体颜色，可根据喜好修改 */
            font-size: 1.1em;
        }

        /* 为表格每个单元格设置一个背景颜色 */
        tbody td {
            background-color: #f2f2f2; /* 示例背景颜色，可根据喜好修改 */
            border-bottom: 1px solid #ddd; /* 为了清晰分隔各行 */
        }

        /* 为操作按钮增加一些样式来使其更加醒目 */
        .order-detail-toggle {
            border: none; /* 移除边框 */
            color: white; /* 设置字体颜色 */
            padding: 5px 10px; /* 设置内填充 */
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            transition-duration: 0.4s;
            cursor: pointer;
            background-color: #008CBA; /* 背景颜色 */
        }

        /* 当鼠标悬停在操作按钮上时，改变其样式以提供反馈 */
        .order-detail-toggle:hover {
            background-color: #333;
            color: white;
        }

        .modal {
            display: none; /* 默认不显示模态框 */
            position: fixed; /* 固定定位 */
            z-index: 1; /* z-index 确保模态框在其他内容上方 */
            left: 0;
            top: 0;
            width: 100%; /* 宽度为整个视窗的宽 */
            height: 100%; /* 高度为整个视窗的高 */
            overflow: auto; /* 如果内容过多，出现滚动条 */
            background-color: rgba(0, 0, 0, 0.4); /* 背景颜色带透明度 */
        }

        .modal-content {
            background-color: #fefefe; /* 模态框内容背景颜色 */
            margin: 15% auto; /* 上下外边距及自动居中 */
            padding: 20px; /* 内边距 */
            border: 1px solid #888; /* 边框 */
            width: 80%; /* 宽度 */
        }

        .close {
            color: #aaa; /* 关闭按钮颜色 */
            float: right; /* 右浮动 */
            font-size: 28px; /* 字号 */
            font-weight: bold; /* 字重 */
        }

        .close:hover,
        .close:focus {
            color: black; /* 鼠标悬浮或聚焦时颜色改变 */
            text-decoration: none;
            cursor: pointer;
        }


        /* 其他样式保持不变 */
    </style>
</head>
<body>

<div class="head">
    <div class="head-in">
        <ul class="options">
            <li class="sub"><a href="/user/userorder">我的订单</a></li>
            <li class="sub"><a href="/user/userserve">客户服务</a></li>
        </ul>
        <div class="register"><a href="{% url 'userprofile' %}">查看个人信息</a></div>
        <div class="register"><a href="{% url 'logout' %}">退出登录</a></div>
        <div class="hello">欢迎您！欢迎来到数码产品网上交易平台</div>
    </div>
</div>
<div class="search">
    <div class="input">
        <input type="" name="" value="请输入想找的宝贝">
        <img src="{% static '首页_files/1_06.png' %}">
    </div>
</div>
<div class="classes">
    <ul class="classes-items">

        <li class="items"><a href="http://127.0.0.1:8000/shop/shoppage/myproducts/?category_id=0">我的商品</a></li>
        <li class="items"><a href="http://127.0.0.1:8000/shop/shoppage/manage_products/?category_id=0">管理商品</a></li>
        <li class="items"><a href="http://127.0.0.1:8000/shop/shoppage/shop_order/">我的订单</a></li>
        <li class="items"><a href="http://127.0.0.1:8000/shop/shoppage/sales_analysis/">销售分析</a></li>
    </ul>
</div>
<table>
    <thead>
    <tr>
        <th>订单ID</th>
        <th>用户</th>
        <th>状态</th>
        <th>支付时间</th>
        <th>订单时间</th>
        <th>总价</th>
        <th>操作</th> <!-- 添加一个标题用于展示操作按钮 -->
    </tr>
    </thead>
    <tbody>
    {% for order in orders %}
        <tr>
            <td>{{ order.o_id }}</td>
            <td onclick="showUserModal({{ order.user.u_id }})">{{ order.user.u_name }}</td>
            <td>{{ order.status }}</td>
            <td>{{ order.paid_time }}</td>
            <td>{{ order.o_time }}</td>
            <td>{{ order.total_price }}</td>
            <td>
                <button class="order-detail-toggle" onclick="toggleOrderDetails('details-{{ order.o_id }}')">
                    查看详情
                </button>
            </td>
        </tr>
        <tr id="details-{{ order.o_id }}" class="order-details">
            <td colspan="7">
                <table>
                    <thead>
                    <tr>
                        <th>订单详情ID</th>
                        <th>商品</th>
                        <th>商店</th>
                        <th>数量</th>
                        <th>当前单价</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for detail in order.orderdetails_set.all %}
                        <tr>
                            <td>{{ detail.order_detail_id }}</td>
                            <td onclick="showProductModal({{ detail.product.product.p_id }})">{{ detail.product.product.p_name }}</td>
                            <td>{{ detail.shop.s_name }}</td>
                            <td>{{ detail.quantity }}</td>
                            <td>{{ detail.current_single_price }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>
<!-- 用户信息模态框 -->
<div id="userModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('userModal')">&times;</span>
        <h2>用户信息</h2>
        <!-- 用户信息显示位置 -->
        <div id="userModalInfo">
            <p>用户名: <span id="userModal_u_name"></span></p>
            <p>性别: <span id="userModal_u_sex"></span></p>
            <p>手机号: <span id="userModal_u_phone"></span></p>
            <p>邮箱: <span id="userModal_u_email"></span></p>
            <p>地址: <span id="userModal_u_address"></span></p>
        </div>
    </div>
</div>

<!-- 商品信息模态框 -->
<div id="productModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('productModal')">&times;</span>
        <h2>商品信息</h2>
        <!-- 商品信息显示位置 -->
        <div id="productInfo">
            <p>商品名称: <span id="productModal_p_name"></span></p>
            <p>商品类型: <span id="productModal_p_type"></span></p>
            <p>品牌: <span id="productModal_brand"></span></p>
            <p>当前价格: <span id="productModal_current_price"></span></p>
            <p>商品描述: <span id="productModal_product_desc"></span></p>
            <p>商品状态: <span id="productModal_product_status"></span></p>
            <p>库存数量: <span id="productModal_stock_quantity"></span></p>
            <p>原始价格: <span id="productModal_original_price"></span></p>
            <p>商品折扣: <span id="productModal_discount"></span></p>
            <p>商品图片:</p>
            <img id="productModal_product_image" src="" alt="" width="200" height="200">
        </div>
    </div>
</div>

<script>
    function toggleOrderDetails(detailId) {
        var details = document.getElementById(detailId);
        if (details.style.display === 'none' || details.style.display === '') {
            details.style.display = 'table-row'; // 显示订单详情
        } else {
            details.style.display = 'none'; // 隐藏订单详情
        }
    }

    // 打开模态框的函数
    function openModal(modalId, content) {
        // 将内容添加到模态框中
        document.getElementById(modalId + 'Info').innerHTML = content;
        // 显示模态框
        document.getElementById(modalId).style.display = 'block';
    }

    // 关闭模态框的函数
    function closeModal(modalId) {
        // 隐藏模态框
        document.getElementById(modalId).style.display = 'none';
    }

    // 在用户点击用户名时调用的函数
    function showUserModal(userId) {
        // 发起 AJAX 请求以获取用户信息
        fetch('/shop/shoppage/shop_order/user/' + userId + '/') // 请注意路径的改变
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(user => {
                // 以下代码是将获取到的用户数据填充到模态框
                document.getElementById('userModal_u_name').textContent = user.u_name;
                document.getElementById('userModal_u_sex').textContent = user.u_sex;
                document.getElementById('userModal_u_phone').textContent = user.u_phone;
                document.getElementById('userModal_u_email').textContent = user.u_email;
                document.getElementById('userModal_u_address').textContent = user.u_address;
                // 显示模态框
                document.getElementById('userModal').style.display = 'block';
            })
            .catch(error => {
                console.error('Error fetching user data:', error);
            });
    }

    function showProductModal(p_id) {
        // 发起 AJAX 请求以获取商品信息
        fetch('/shop/shoppage/shop_order/product/' + p_id + '/')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(product => {
                // 以下代码是将获取到的商品数据填充到模态框
                document.getElementById('productModal_p_name').textContent = product.p_name;
                document.getElementById('productModal_p_type').textContent = product.p_type;
                document.getElementById('productModal_brand').textContent = product.brand;
                // 如果您想显示其他信息，那么以下是示例
                // 确保这些元素在商品信息模态框中有对应的 span 标签
                document.getElementById('productModal_current_price').textContent = product.current_price;
                document.getElementById('productModal_product_desc').textContent = product.product_desc;
                document.getElementById('productModal_product_status').textContent = product.product_status;
                document.getElementById('productModal_stock_quantity').textContent = product.stock_quantity;
                document.getElementById('productModal_original_price').textContent = product.original_price;
                document.getElementById('productModal_discount').textContent = product.discount;
                // 设置商品图片
                var productImage = document.getElementById('productModal_product_image');
                var imageUrl = product.product_image_url ? '{% static "商品图片/" %}' + product.product_image_url : '{% static "商品图片/暂无图片.png" %}';
                productImage.src = imageUrl;
                productImage.alt = product.p_name || '商品图片'; // 使用商品名称作为图片的alt文本，如果没有名称则使用'商品图片'

                // 显示模态框
                document.getElementById('productModal').style.display = 'block';
            })

    }

</script>

</body>

</html>